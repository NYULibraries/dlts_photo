YUI().use("node","event","pjax",function(e){"use strict";function s(t){t.halt();var n=e.one(".node.pjax"),r=0,i=e.one(".pjax-container");n?r=Math.round(parseInt(n.getAttribute("data-sequence"),10)/20):i&&(r=Math.round(parseInt(i.getAttribute("data-sequence"),10)/20)),location.href=t.currentTarget.get("href")+"?page="+r}var t=new e.Pjax({container:".pjax-container"}),n=function(n){n.preventDefault();var r;e.Lang.isObject(n.referenceTarget,!0)?r=n.referenceTarget.getAttribute("data-url"):r=this.get("href"),t.navigate(r)},r=function(t){var n,r,s,o,u,a,f,l,c;n=t.content.node,r=n.one(".dlts_image_map"),s=n.one(".next-page"),o=n.one(".previous-page"),f=parseInt(n.getAttribute("data-sequence"),10),l=parseInt(n.getAttribute("data-sequence-count"),10),u=e.one(".navbar .previous-page"),a=e.one(".navbar .next-page"),o||(o=n.one(".previous-page-off")),s||(s=n.one(".next-page-off")),u||(u=e.one(".navbar .previous-page-off")),a||(a=e.one(".navbar .next-page-off")),u.replace(o.cloneNode(!0)),a.replace(s.cloneNode(!0)),c={id:r.get("id"),title:n.getAttribute("data-title"),node:r,boxes:[],sequence:n.getAttribute("data-sequence"),uri:r.getAttribute("data-uri"),metadata:{width:r.getAttribute("data-width"),height:r.getAttribute("data-height"),levels:r.getAttribute("data-levels"),dwtLevels:r.getAttribute("data-dwtlevels"),compositingLayerCount:r.getAttribute("data-compositing-layer")}},e.on("available",i,"#"+c.id,OpenLayers,c)},i=function(t){var n,r,i,s;s=OpenLayers.DLTS,e.Lang.isObject(s.pages[0],!0)&&(n=s.pages[0],r=n.baseLayer.url,i=n.getZoom(),n.destroy(),s.pages=[]),e.Object.isEmpty(s.pages)&&(s.Page(t.id,t.uri,{zoom:i,boxes:t.boxes,service:r,imgMetadata:t.metadata}),e.on("contentready",function(){e.fire("openlayers:change",t),e.later(3e3,e.one(".pane.load"),function(){this.hide()})},"#"+t.id))},o=function(e){this.addClass("loading"),this.show()};e.one("body").delegate("click",n,"a.previous-page, a.next-page"),e.one("body").delegate("click",s,"a.thumbnails"),t.on("load",r),t.on("navigate",o,e.one(".pane.load")),e.on("contentready",function(){e.later(500,e.one(".pane.load"),function(){this.hide()})},".dlts_image_map")});
